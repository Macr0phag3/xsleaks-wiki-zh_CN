+++
title = "有状态的浏览器功能"
description = ""
date = "2020-10-01"
category = "Historical"
defenses = [
    "Browser Fix"
]
menu = "main"
+++

一些浏览器功能/扩展会改变请求的处理方式，这取决于浏览器生成的某些网站状态。攻击者有时可以观察到整个过程并扰乱浏览器，触发对这些状态产生副作用的行动。

Some browser features/extensions change the way requests are processed, depending on certain website states generated by the browser. Attackers can sometimes observe the whole process and mess with the browser, triggering actions that produce side effects on those states.

## WebKit – ITP
[智能跟踪防御](https://webkit.org/tracking-prevention/) (ITP)是一项隐私功能，是 [WebKit 跟踪防御技术](https://webkit.org/tracking-prevention/)的一部分。它是几个功能的结合，旨在防止网站在第三方环境中跟踪用户。不幸的是，最初的设计引入了一个新的 XS-Leak [^1]，允许攻击者利用 ITP 将网站归类为追踪者。

[Intelligent Tracking Prevention](https://webkit.org/tracking-prevention/) (ITP) is a privacy feature which is part of [WebKit Tracking Prevention technologies](https://webkit.org/tracking-prevention/). It's a conjunction of several features and aims to prevent a website from tracking a user under a third-party context. Unfortunately, the initial design introduced a new XS-Leak [^1], allowing attackers to abuse the states implicitly created by ITP to classify websites as trackers.

### 根本原因
为了对一个网站是否具有跟踪功能进行分类，ITP 收集了关于资源负载以及用户与网站互动的统计数据，如点击、点选或文本输入。根据这些统计数据的分类，如果一个网站被认为具有跟踪功能，ITP 就会对其进行打击。在被打击 3 次后，网站将被列入拒绝名单，并在今后的请求中被浏览器区别对待。

To classify whether a website has tracking capabilities, ITP collects statistics on resource loads as well as on user interactions with websites such as clicks, taps, or text entries. Based on the classification of these statistics, ITP gives a strike to a website if it is believed to have tracking capabilities. After 3 strikes, a website is put on a deny list and is treated differently by the browser in future requests.

#### 问题
ITP 的一个问题是，攻击者可以操纵它来完成某些行为。例如，攻击者可以强迫 ITP 对一个域名进行打击，并检查该域名是否已经进入了拒绝列表。这一信息可以以不同的方式加以利用，例如，以：

One of the issues of ITP is that attackers can manipulate it to arbitrarily enforce certain behaviors. For example, an attacker could force ITP to give a strike to a domain and check if the domain entered the deny list. This information could be leveraged in different ways, for example to:

- 根据一个域名进入拒绝列表所需的打击次数，泄露用户的浏览习惯。
- 使用拒绝列表对一个页面实施 XS-Search 攻击，只有在出现结果时才会包含跨站资源。
---
- Leak the user's browsing habits based on how many strikes are necessary for a domain to enter the deny list.
- Use the deny list to implement an XS-Search attack against a page that includes cross-site resources only when results are present.

### 修复
为了[解决这个问题](https://webkit.org/blog/9661/preventing-tracking-prevention-tracking/)，ITP 现在默认认为每个网站都是 “跟踪者” 网站，而不是依靠分类。这消除了那些隐含状态，这些状态允许攻击者检测某些 ITP 行为。

To [fix the issue](https://webkit.org/blog/9661/preventing-tracking-prevention-tracking/), ITP now considers every site to be a "tracking" site by default, instead of relying on classifications. This removes the implicit states which allowed attackers to detect certain ITP behaviors.

## 参考文献

[^1]: Information Leaks via Safari’s Intelligent Tracking Prevention, [link](https://arxiv.org/pdf/2001.07421.pdf)
[^2]: Preventing Tracking Prevention Tracking, [link](https://webkit.org/blog/9661/preventing-tracking-prevention-tracking/)
